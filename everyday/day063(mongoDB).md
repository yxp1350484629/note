# day063(mongoDB)

1.索引

索引的主要目的是为了加快检索速度，不用从头开始一个个查找。当然也可以添加唯一性等

索引是真实存在，和表一样存于磁盘中，和目录一样的，当创建后，其实就在索引表中给要创建的域（字段）排好了顺序，mysql.mongodb用Btree的方式来排序，方便进行查找

mongodb索引操作

db.集合名.ensureIndex({},{})

第一个{}中放需要建立索引的域，用键值对的形式，1代表正序索引，-1代表逆序索引

放一个的就是就是建立一个索引，也可以放多个，就是建立复合索引

注意当我们每次只通过一个域来进行查找的时候，建立复合索引没有意义，当我们经常通过这个，或者那个查找的时候，我们不必要建立两个索引，这样太占磁盘，我们可以建立一个复合索引，它比一个单独索引大，比两个索引小。

第二个{}，可以放索引姓名，添加唯一性，稀疏索引

也可以放多个键值对，就是既可以添加姓名，也可以添加唯一性，稀疏索引

添加姓名就是name:值  

唯一性就是 unique:true  注意唯一性只能给整个集合的那个域的所有值不重复时添加，添加后，如果插入文档那个域值和其他文档重复，则不能添加

稀疏索引 sparse:true 是在mongodb中各个文档域名都可以不同，很多文档没有我们建立的那个域名索引，在索引表中就为空结点(Btree)，我们就需要建立稀疏索引，只把有这个域的文档添加到Btree中，这样就简化了结构，提升了效率

当我们给某个域添加索引后，如果某个文档的这个域是数组，或者是内部文档，当我们通过点查询里面的值也是索引查询

查看集合中所有索引 db.集合名.getIndexes() 注意除了我们建立的索引外，还有_id时系统建立的主键索引

删除索引 db.集合名.dropIndex(索引名或者键值对)

删除所有索引 db.集合名.dropIndexes()  注意_id是系统建立的主键索引，不可删除

索引也有不太好的地方，第一就是占空间，第二就是每次更新文档，都要维和更改索引

所以索引只适合数据很庞大，而且有频繁的查找操作，而不是修改操作的集合中，数据量太小也不适合建立索引，因为一下子就找到了，建立的索引也不是越多越好

2.

1、分组与聚合原理：
分组是使用特定的条件将元数据进行划分为多个组。聚合是对每个分组中的数据执行某些操作，最后将计算结果进行整合。

分组与聚合的过程大概分三步：

拆分：将数据集按照一些标准拆分为若干组。
应用：将某个函数或者方法应用到每个分组。
合并：将产生的新值整合到结果对象中。

3.

Mongodb中的聚合操作

要进行聚合操作需要 db.集合名.aggregate 来专门进行聚合操作

聚合操作有两个重点，第一个是分组聚合，比如

db.class0.agreegate({group:{_id:'$name',num:{$sum:''$age'}})  还有$avg,$min,$max

是先进行分组，然后根据函数计算，最后再聚合，

注意按照什么分组，必须是给的_id:  ，系统规定，按照什么分组，是按照整个集合的所有域名，得用'$'开头加域名，然后分组内的计算函数用相关的操作符:后面也是接'$'+域名，因为这是针对所有文档的域名，不是单指某一个，计算函数外面写要聚合成的域名。

大致于是分组内的计算函数，然后根据分组然后计算的结果再整体上进行聚合。

第二个重点就是agreegate不仅仅只能进行分组聚合，还能配合查找和排序等，因为mysql中的select后面可以接很多，而agreegate如果不能进行查找，排序等操作，就没办法完成复杂事务

$match函数和find的小部分效果一样，就是查找满足条件的结果

db.class0.agreegate({$match:{age:{$gt:9}})

$project 和find后面的要显示什么一样 $project:{} {}中放入多个键值对，和find第二个参数一样

$limit筛选前几条数据文档 比如db.class0.agreegate({$limit:3}) 筛选前三条文档

$skip 跳过前多少条文档，直接显示后面的

$sort 根据什么排序，也是db.class0.agreegate({$sort:{age:1}}) 

这些单个的小操作并没有什么意义，用find可以更好的完成

第二个重点就是把这些操作都结合起来的聚合管道

db.class0.agreegate([{},{},{}])  一个{}接一个操作，就是在上一个聚合的结果上，在进行操作，不断聚合，形成聚合管道，不同的搭配，这样就完成了和mysql select一样的功能

4.域值为null的意义

a.说明域值没有意义

b,可以匹配某个域不存在（搜索不存在的域时，会匹配到)



