# day060(mongoDB1)

1.

数据结构：指描述数据集合内数据之间的关系

数据库：是按照一定的数据结构，对数据进行存储的仓库。是在数据库管理系统下，在一定介质上的数据集合

数据库管理系统：应用层数据库软件，一般在应用层的代码加载到内存通过操作系统对底层外存储器数据库进行操作。

数据库系统：就是指应用层的数据库管理系统和底层的数据库组成的集合

关系型数据库：数据库是按照一定存储结构存储数据，而这些数据结构也需要组织，而关系型是按照关系模型（二维表)将这些数据结构组织起来的

关系型数据库一致性强，每次搜寻导入数据，都要经过那几个字段。而且代码需要过多的解析，速度比较慢，不适应高并发。

但是数据严密，发展成熟。

非关系型数据库没有那么强的一致性，比较灵活。就能在瞬间导入多个数据，并发量高，且应用层代码接近原生，不需要过多的解析，速度比较快。

但是容易出错，语句不兼容，非关系型数据库统称NOSQL，但是语句多种多样

举个例子，注册的情况，有些可填可不填，有些可以有多个选项，关系型数据库就需要全部列出字段，保持一致性，非关系型不需要

现在很多处理高并发都是使用非关系型数据库得到数据，然后慢慢导入关系型数据库中

复习请参照mongoDB第一天2，3节

2.

MongoDB的安装位置（自动安装的默认位置）

默认数据库安装存储位置 /var/lib/mongodb

配置文件的存储位置 ：mongodb相关配置的存储位置

命令集存储位置 /user/bin /user/local/bin 

当我们安装mysql，mongodb,python才能在Linux命令行中使用相关命令 ，而命令集就在这些文件内

ls /user/bin  查看命令集

注意这些文件位置套用到其他软件也是差不多的位置，自动安装的默认位置

手动安装一般可以通过whereis 命令查看命令集，比如where is mongo

手动安装还注意一点，就是命令集文件没有在全局变量路径中，就会在其他目录下找不到

需要添加的全局变量路径中

PATH=$PATH:路径 

export PATH  两步完成添加，但是这个是临时醒的，下次启动就会消失

我们可以把这两句命令写入到启动脚本中 ,打开/etc/rc.local，写入保存

注意最好是默认安装

3.

相关命令

mongod --dbpath 路径 修改数据库的存储位置

mongod --port 8080 设置mongodb监听端口为8080

默认监听端口为 27017

mongo 命令是进入mongodb数据库交互界面，和mysql -uroot...一样，进入后可以进行语句操作了

mongo shell进入交互界面 ctrl+c退出 quit()  exit都行

4.mongodb与mysql比较

简单的一条数据，以某种数据结构存储，Mysql按关系模式将这些数据组织起来成为一张纸二维表，这些二维表形成了一个个数据库

而在mongodb中，一条简单的数据，以某种数据结构存储，基础是一个个键值对，mongb将这些键值对按照文档模式组织成一个个文档，这些文档加起来形成一个集合，一个集合就相当于一个二维表了，由着些集合组成数据库

注意文档的形式是把一条数据转化为键值对，用{}包裹，和python中的字典一样，但在mongo中叫文档

mongo是文档型数据库，当然还有专门的键值对数据库,比如redis

5.在mysql表中的字段，在mongo中是域

6.交互界面语句操作

use 数据库名  创建数据库 ，(其实是使用这个数据库，当没有这个 数据库时，会创建这个数据库，当然当插入数据时，这个数据库才会真正存在）

show dbs 显示所有数据库，用use创建的数据库只有插入数据后，才会在这显示

系统数据库

admin 存储用户信息

local  存储本地数据，不能通过网络得到，只在本地处理的数据

config 存储分片信息，只有在空间不够用，需要分片的时候才要用到

在mongodb中是严格区分大小写，不像mysql关键字不区分大小写,mongodb默认编码为utf-8

在mongo中使用面向对象的思想，use 数据库名 之后，就相当于吧这个数据库用变量db绑定了，后面的用这个变量操作就行了，怎删改查什么都是用db.方法进行的。

当不使用任何数据库时，db默认会有一个数据库名，插入数据也就创建了该数据库，操作都是对它

7.数据库备份与恢复

备份到某个文件夹：

mongodump -h 主机名 -d 数据库名 -o 目标文件夹  没有这个文件夹就创建这个文件夹

注意mongodump是shell命令，在shell交互界面下运行，不是在mongo界面

将某个文件夹下的文件恢复到mongo中

mongorestore -h 主机名:端口号 -d 要恢复到的数据库名(没有这个数据库就自动创建)  文件夹下文件路径

数据库的监控

mongostat 会显示每秒怎删改查以及与磁盘交互等的次数 ，我们运行一个大程序，可观察这个次数

以mongo开头的命令都是在shell终端

mongotop 监测数据库的读写时间

8.mongo界面主要操作命令

**在mongo中没有sql语句，用的面向对象思想，本身也是用c++编写，后面的主要操作命令都是用对象调用函数来完成的，这里面的函数采用小驼峰法**

db.dropDatabase（）删除db代表的数据库

创建集合

1.db.createCollection('集合名')

2.db.集合名.insert(文档)  自动创建了那个集合

show collections 显示所有集合

删除集合

db.集合名.drop()

修改集合名

db.集合名.renameCollection('集合名')

查看集合中的数据
db.集合名.find()

同时插入多个文档

db.集合名.insert([{},{}...])

当然插入还有insertOne 和insertMany但是没多大意义

save也可以插入数据，而且操作和insert完全一样

save和insert不同的地方：

在插入的域有_id时，如果 _id值和其他文档重复了，insert会报错，提示不能插入，而save会修改把之前那个相同 _id值的文档替换掉。

9.文档的几个点

1.mongodb文档的键必须是utf-8的字符串，加引号不加引号都行，肯定是utf8字符串

2.键值对是有序的

3.文档键值对是bson格式，javascript键值对是json

4，键值严格区分大小写

5.文档的值不需要严格定义是什么类型，你敲进去是什么类型就是什么类型，但是它支持比mysql更多的数据类型

整形，布尔，时间，时间戳，字符串，数组，浮点型，二进制，null,object (内部文档，也就是值也可以是一个文档)，regex正则字串 

ObjectID 默认文档中会有这个ID，mongo默认添加唯一的ID，就不需要人为添加了。

文档中在没有人为地定义_id域的情况下，mongo会自动给文档添加这个，和mysql中唯一id一样

24位，8位文档创建时间  6位机器ID 4位 进程ID 6位计数器 总共24位通过算法生成唯一的ID

_id值自己插入，在一个集合中是不能重复的

6.集合中的各个文档不一定有相同的域，想添加什么就添加什么。键值对个数都可以不同

而且集合中各个文档相互不影响

如果注册时有一项是四选一，关系型数据库必须把四个都写上，因为不同数据还要保持一致性，而mongodb可以根据你写了什么就添加什么，文档之间还没有关联，特别灵活

7.虽然文档很灵活，但是尽量要一个文档描述一个事物，不要多重描述，这样的数据没用。而且文档本来就是类似于字典的形式，就不要再在里面放更多层的文档和数组，这样显得太复杂，不好处理。

尽量同一类型数据放在一个集合中。