# day056(进程池，进程间的通信+)

1.原理，进程是动态的，一般是启动进程，把事件放进去运行，然后时间运行完进程销毁，但是进程有一个致命的缺点，就是创建删除会消耗大量的操作系统资源，不适合做处理时间比较短的事件，因为要频繁创建销毁，更适合做时间较长的事件。

为了解决这一问题，引发了进程池，就是在一个进程池中创建几个进程，然后设计一个事件队列，一次把事件放进进程池中的进程里面处理，处理完进程仍在进程池中不销毁，等待下一个事件进入，那个进程空了，就把队列后面的事件放进去

多个进程可以占用多个核，但是同一时间只能有一个进程占用同一个核,感觉如果进程不多，会先把几个核占满，再多就需要频繁切换了

步骤

1.创建进程池，在池中放入适当的进程。（一般计算机有几核，就创建几个进程)

2.将事件放到队列中。

3.不断把事件放入进程池中的进程中执行，直到全部执行完。

4.关闭进程池，回收进程。

**记住定义事件函数必须要在创建进程池之上**，创建进程池就是同时创建了那几个子进程，由于进程池机制的问题，事件函数必须在创建进程池之上，这样进程池才能读到这些函数。

用apply_async 方法来为进程池中的队列添加事件，也就是那些函数，第一个参数是func,之后args,kwargs

用apply_map方法来批量为进程池中的队列添加事件，第一个参数为func，第二个参数为iter，为可迭代对象，不停从iter中取出值给func，然后func返回值作为一个个事件

2.进程间的通信方法

1.套接字，本地套接字，网络套接字，也是进程之间通信常用的方法

2.通信管道 

只要不同进程之间有相同的管道对象，就能把进程之间连接起来，只要有相同的管道对象，多个进程都可以相互连接，如何拥有相同的管道对象呢，在父进程中创建管道对象，子进程复制就是很好的办法。

注意如果存在多个进程拥有相同数据管道的情况，一个进程发一个数据，按理说是所有进程都能接收到，但其实只有一个进程能收到，看先后把，就相当于所有数据都发在一个通信管道，所有进程都从这个管道中读，当然读完了就没有了。**在内存中开辟一片空间，只要管道对象相同，所有数据发收都在这篇空间内**

fd1,fd2=Pipe(True，False)默认为True就是创建双向的管道，设置为False就是创建单向管道

双向管道是随便fd1发收，fd2发收都可以，但是如果f1发了，另一端也必须f2收，但fd1也可以发。单向管道必须fd1收，fd2发 也就是在父进程中,fd2发，子进程中fd1收，子进程中fd2发，父进程中fd1收，单向的

通信管道对象属于是在操作系统中的一片内存，所有发送数据都在这片操作系统内存里，而操作系统内存可以自由识别python代码，所以通信管道对象无论发送什么，字典元组等待，都可以，不需要规定必须是字节什么的。

一般只用于父子进程，只用于两端，端多了不好处理

3.消息队列

消息队列和通信管道大致是一样的，都是在内存中开辟一片空间，只要队列对象相同就可以写收，但是消息队列在空间中有顺序结构，相当于一个队列，写是从左边进，获取是从右边获取，也就是先写入的先获取。

Queue类创建，后面参数为队列大小，如果不添加，就是系统自动分配大小

put是写入方法，第一个参数是数据，和通信管道一样，写任何操作系统能识别的python数据都行，第二个参数为block，默认为True，当队列慢的时候，put方法会变成阻塞函数，也就是下一次用put的时候，会阻塞在哪，不会执行下去，第三个参数为timeout就是超时阻塞，只有阻塞的时候，这个参数才有用

get是获取方法，get()获取第一个put写入的数据，有两个参数和get一样的，当队列为空，下一次执行get就是阻塞函数。

full,empty,是判断队列是否为满，空,qsize是获取队列大小

比较灵活，适合多方

4.共享空间类Value，Array

Value是共享内存的一个值，Array是共享内存的一个数组，用Value创建的对象，只要对象相同，不同进程可以共用这个对象属性，注意这个和文件，网络对象属性偏移类似，这个是专门的共享内存对象

Value(属性，值) 第一个属性，比如'i' 就是表示这个值只能是整数，后面就赋一个整数初值。其他的属性自己查询

可以用对象.value来访问这个共享对象的属性，属性是公用的，也就是后面的值

Array(属性，值) 注意Array从c语言中来，c中的数组只能表示同类型的值，比如前面给个i，后面就是一个列表，列表里面只能表示整数，也就是c中的数组，当然后面的值也可以表示个数。

Array('i',[1,2,3]) 就是后面直接给数组对象  Array('i',3) 也给了一个数组对象，这个数组对象里只有三个空间，需要我们自己赋值，默认全为0

注意Array不能用value来访问值，在Array中，value表示c中的地址，但是我们可以直接用对象访问值，也支持迭代和索引

Array('c',b'kjk')  表示一个字符串，这个字符串必须是字节形式，值就是b'kjk’  value表示c中的地址 但c中字符串可以用地址访问，所以可以用value来访问Array字符串

注意共享空间只能存储一个值，或者一个数据结构。可以作为多个进程中存储数据的一个东西？

共享空间是效率较高的，但要注意互斥

